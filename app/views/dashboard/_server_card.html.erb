<%# Modern Server Card with DaisyUI
    Displays individual server with modern, clean design
    Usage: <%= render 'dashboard/server_card', server: @server %>
%>

<%= link_to server_path(server), class: "block" do %>
  <div class="card bg-base-200 border border-base-content/10 hover:border-primary/50 hover:shadow-xl transition-all duration-200 compact-card-hover" data-server-id="<%= server.id %>">
    <div class="card-body p-4">

      <!-- Header: Status Badge + Hostname -->
      <div class="flex items-center justify-between mb-3">
        <div class="flex items-center gap-2 min-w-0 flex-1">
          <div class="badge <%= server.status == 'online' ? 'badge-success' : server.status == 'offline' ? 'badge-error' : 'badge-warning' %> gap-1">
            <span class="status-dot status-<%= server.status %>"></span>
            <%= server.status.capitalize %>
          </div>
        </div>
        <% if server.provider.present? %>
          <div class="badge badge-ghost badge-sm"><%= server.provider %></div>
        <% end %>
      </div>

      <!-- Hostname -->
      <h3 class="card-title text-base font-mono mb-3"><%= server.hostname %></h3>

      <!-- Metrics -->
      <% if server.latest_metrics.present? %>
        <% metrics = server.latest_metrics.is_a?(String) ? JSON.parse(server.latest_metrics) : server.latest_metrics %>
        <% cpu_percent = metrics['cpu_percent']&.to_f || 0 %>
        <% memory_percent = metrics['memory_percent']&.to_f || 0 %>
        <% disk_percent = metrics['disk_percent']&.to_f || 0 %>

        <div class="space-y-3">
          <!-- CPU Progress -->
          <div>
            <div class="flex justify-between text-xs text-base-content/60 mb-1">
              <span class="font-medium">CPU</span>
              <span class="font-mono"><%= cpu_percent.round %>%</span>
            </div>
            <progress
              class="progress <%= cpu_percent >= 90 ? 'progress-error' : cpu_percent >= 80 ? 'progress-warning' : 'progress-primary' %> w-full"
              value="<%= [cpu_percent, 100].min %>"
              max="100">
            </progress>
          </div>

          <!-- RAM Progress -->
          <div>
            <div class="flex justify-between text-xs text-base-content/60 mb-1">
              <span class="font-medium">RAM</span>
              <span class="font-mono"><%= memory_percent.round %>%</span>
            </div>
            <progress
              class="progress <%= memory_percent >= 90 ? 'progress-error' : memory_percent >= 80 ? 'progress-warning' : 'progress-secondary' %> w-full"
              value="<%= [memory_percent, 100].min %>"
              max="100">
            </progress>
          </div>

          <!-- Disk Progress -->
          <div>
            <div class="flex justify-between text-xs text-base-content/60 mb-1">
              <span class="font-medium">Disk</span>
              <span class="font-mono"><%= disk_percent.round %>%</span>
            </div>
            <progress
              class="progress <%= disk_percent >= 90 ? 'progress-error' : disk_percent >= 80 ? 'progress-warning' : 'progress-accent' %> w-full"
              value="<%= [disk_percent, 100].min %>"
              max="100">
            </progress>
          </div>
        </div>
      <% else %>
        <div class="alert alert-info py-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          <span class="text-xs">No metrics available</span>
        </div>
      <% end %>

      <!-- Footer: OS -->
      <div class="divider my-2"></div>
      <div class="flex justify-end items-center text-xs">
        <div class="badge badge-outline badge-xs">
          <%= server.os_name&.split(' ')&.first || 'Unknown' %>
        </div>
      </div>
    </div>
  </div>
<% end %>
